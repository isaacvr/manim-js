<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Animations Framework</title>
    <style>
      button, select, input {
        padding: 5px;
      }
    </style>
  </head>
  <body>

  </body>
  <script src="./dist/animator.js" type="module"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.9.0/p5.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.9.0/addons/p5.dom.min.js"></script>
  <script>

    let shapes = {};
    let fig;
    let figs;
    let eass;
    let btn1;
    let btn2;

    function init() {
      shapes['p1'] = new Dot(30, 40);
      shapes['p2'] = new Dot(-40, 80);
      shapes['circ'] = new Circle(0, 0, 200);
      shapes['rec'] = new Rectangle(-250, -90, 500, 180);
      shapes['tri'] = new Triangle(50, -160, 410, 20, 151, 89);
      shapes['path'] = new Path([
        new Point(-550, -160),
        new Point(-450, 60),
        new Point(0, -260),
        new Point(46, -160),
        new Point(-35, -160)
      ]);
      shapes['lin'] = new Line(new Point(-200, 230), new Point(40, -30));
      shapes['star'] = new Star(0, 0, 6, 190, 70);
      fig = shapes['circ'].clone();
    }

    function fancyTransition() {
      let arr = [ 'rec', 'tri', 'path', 'p1', 'lin', 'star', 'circ' ];

      btn1.elt.disabled = true;
      btn2.elt.disabled = true;

      // let arr = [ 'rec', 'tri', 'path', 'p1' ];

      let f = (pos) => {
        if ( pos < arr.length ) {
          let fig1 = shapes[ arr[pos] ];
          let dur = +speedSlider.value();
          return Animator.play(Transform( fig, fig1, dur, 'softBounce' )).
            then(() => Animator.wait()).
            then(() => f(pos + 1));
        } else {
          // console.log('LALALA');
          btn1.elt.disabled = false;
          btn2.elt.disabled = false;
        }
      };

      f(0);
    }

    function setup() {
      createCanvas(1500, 700);

      createP('');

      figs = [ 'p1', 'p2', 'circ', 'rec', 'tri', 'path', 'lin', 'star' ];
      eass = [ 'linear', 'easeIn', 'easeOut', 'easeInOut', 'bounce', 'softBounce' ];

      btn1 = createButton('Animate');
      btn2 = createButton('Animate reverse');

      let speedSlider;

      let __animate = function(f1, f2, dur, easing) {
        btn1.elt.disabled = true;
        btn2.elt.disabled = true;
        fig = shapes[ f1 ].clone();
        Animator.play( Transform( fig, shapes[ f2 ], dur, easing ) ).
          then(() => btn1.elt.disabled = btn2.elt.disabled = false);
      };

      btn1.mousePressed(() => {
        __animate( from.value(), to.value(), +speedSlider.value(), easingSelect.value() );
      });

      btn2.mousePressed(() => {
        __animate( to.value(), from.value(), +speedSlider.value(), easingSelect.value() );
      });

      speedSlider = createSlider(100, 50000, 1000, 100);

      let from = createSelect();
      let to = createSelect();
      let easingSelect = createSelect();

      figs.forEach((e) => { from.option( e ), to.option( e ) });
      eass.forEach((e) => { easingSelect.option( e ) });

      // for (let i = 0, maxi = figs.length; i < maxi; i += 1) {
      //   from.option( figs[i] );
      //   to.option( figs[i] );
      // }

      // for (let i = 0, maxi = figs.length; i < maxi; i += 1) {
      //   from.option( opts[i] );
      //   to.option( opts[i] );
      // }

      let reset = createButton('Reset');
      reset.mousePressed(init);

      init();
    }

    function drawFigure(f, str) {

      if ( f instanceof Dot ) {
        stroke(f.color.toHex());
        strokeWeight(8);
        point(f.x, f.y);
        return;
      }

      let objs = f.objects;
      let len = objs.length;

      beginShape();

      if ( f.filled ) {
        fill(f.color.toHex());
      } else {
        noFill();
      }

      stroke( f.border_color.toHex() );
      strokeWeight(str || 3);

      for (let i = 0; i < len; i += 1) {
        vertex(objs[i].x, objs[i].y);
      }

      endShape(( f.closed ) ? CLOSE : null);
    }

    function draw() {
      background(0);
      translate(width >> 1, height >> 1);
      drawFigure(fig);
    }

  </script>
</html>